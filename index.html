<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Screenshot Generator</title>
    <style>
        body { font-family: 'Roboto', Arial, sans-serif; margin: 20px; background: #f0f0f0; }
        canvas { border: 1px solid #ccc; margin-top: 20px; }
        form { margin-bottom: 20px; background: white; padding: 15px; border-radius: 10px; }
        .message-item { margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .message-item select, .message-item input[type="text"], .message-item textarea { margin-right: 10px; }
        .message-item textarea { resize: both; min-width: 200px; min-height: 30px; width: auto; }
        button { margin: 5px; padding: 8px 12px; background: #25D366; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #128C7E; }
        #messagesContainer { max-height: 300px; overflow-y: auto; }
        #footerInput { display: flex; align-items: center; margin-top: 10px; }
        #footerInput textarea { flex: 1; resize: none; min-height: 30px; }
    </style>
</head>
<body>
    <h1>WhatsApp Screenshot Generator (Mirip APK)</h1>
    <form id="form">
        <label>Current Time (Status Bar, e.g., 10:32):</label>
        <input type="text" id="currentTime" value="10:32">
        
        <label>Network Signal (0-4 bars):</label>
        <select id="networkSignal">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4" selected>4</option>
        </select>
        
        <label>WiFi Connected:</label>
        <select id="wifiConnected">
            <option value="true" selected>Yes</option>
            <option value="false">No</option>
        </select>
        
        <label>Battery Level (0-100):</label>
        <input type="number" id="batteryLevel" value="85" min="0" max="100">
        
        <label>Show Chat Header (Nama Kontak & Avatar):</label>
        <select id="showHeader">
            <option value="true" selected>Yes</option>
            <option value="false">No</option>
        </select>
        
        <label>Contact Name (untuk Header):</label>
        <input type="text" id="contactName" value="John Doe">
        
        <label>Upload Avatar (Foto Profil):</label>
        <input type="file" id="avatarUpload" accept="image/*">
        
        <label>Messages:</label>
        <div id="messagesContainer">
            <!-- Messages will be added here dynamically -->
        </div>
        <button type="button" onclick="addMessage()">Add Message</button>
        
        <label>Long Press Index (0-based, e.g., 1 for second message; -1 for no effect):</label>
        <input type="number" id="longPressIndex" value="1" min="-1">
        
        <button type="button" onclick="generateScreenshot()">Generate Screenshot</button>
    </form>
    
    <canvas id="canvas" width="375" height="812"></canvas>
    <br>
    <button id="downloadBtn" onclick="downloadImage()" style="display:none;">Download Image</button>

    <script>
        let messageIndex = 0;
        let avatarImage = null; // Store uploaded avatar
        
        // Handle avatar upload
        document.getElementById('avatarUpload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    avatarImage = new Image();
                    avatarImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
        
        function addMessage(sender = 'Friend', text = 'New message', time = '10:30') {
            const container = document.getElementById('messagesContainer');
            const div = document.createElement('div');
            div.className = 'message-item';
            div.innerHTML = `
                <select class="sender">
                    <option value="Friend" ${sender === 'Friend' ? 'selected' : ''}>Friend</option>
                    <option value="You" ${sender === 'You' ? 'selected' : ''}>You</option>
                </select>
                <textarea class="text" placeholder="Message text">${text}</textarea>
                <input type="text" class="time" value="${time}" placeholder="Time">
                <button onclick="removeMessage(this)">Remove</button>
            `;
            container.appendChild(div);
            messageIndex++;
        }
        
        function removeMessage(btn) {
            btn.parentElement.remove();
        }
        
        // Load initial messages
        addMessage('Friend', 'Halo, apa kabar?', '10:28');
        addMessage('You', 'Baik, kamu?', '10:29');
        addMessage('Friend', 'Juga baik, lagi kerja.', '10:30');
        addMessage('You', 'Oke, nanti ketemu ya.', '10:31');
        
        // Send message from footer
        function sendMessage() {
            const footerTextarea = document.getElementById('footerTextarea');
            const text = footerTextarea.value.trim();
            if (text) {
                const now = new Date();
                const time = now.getHours() + ':' + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();
                addMessage('You', text, time);
                footerTextarea.value = ''; // Clear input
            }
        }
        
        function generateScreenshot() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Get inputs
            const currentTime = document.getElementById('currentTime').value;
            const networkSignal = parseInt(document.getElementById('networkSignal').value);
            const wifiConnected = document.getElementById('wifiConnected').value === 'true';
            const batteryLevel = parseInt(document.getElementById('batteryLevel').value);
            const showHeader = document.getElementById('showHeader').value === 'true';
            const contactName = document.getElementById('contactName').value;
            const longPressIndex = parseInt(document.getElementById('longPressIndex').value);
            
            // Collect messages
            const messages = [];
            document.querySelectorAll('.message-item').forEach(item => {
                const sender = item.querySelector('.sender').value;
                const text = item.querySelector('.text').value;
                const time = item.querySelector('.time').value;
                messages.push({ sender, text, time });
            });
            
            // Background WhatsApp
            ctx.fillStyle = '#E5DDD5'; // WhatsApp background color
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Status Bar
            const statusBarHeight = 44;
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, canvas.width, statusBarHeight);
            
            // Time
            ctx.fillStyle = 'white';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(currentTime, canvas.width / 2, 28);
            
            // Signal (simplified bars)
            ctx.fillStyle = 'white';
            let signalX = 10;
            for (let i = 0; i < 4; i++) {
                const barHeight = 5 + i * 2;
                ctx.fillStyle = i < networkSignal ? 'white' : '#666666';
                ctx.fillRect(signalX + i * 4, statusBarHeight - barHeight - 5, 2, barHeight);
            }
            
            // WiFi icon
            if (wifiConnected) {
                const wifiX = signalX + 20;
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(wifiX + 5, statusBarHeight - 10, 5, 0, Math.PI);
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(wifiX + 10, statusBarHeight - 15, 5, 0, Math.PI);
                ctx.stroke();
            }
            
            // Battery
            const batteryX = canvas.width - 30;
            ctx.strokeStyle = 'white';
            ctx.strokeRect(batteryX, statusBarHeight - 15, 20, 10);
            ctx.fillRect(batteryX + 20, statusBarHeight - 12, 2, 4);
            const fillWidth = (18 * batteryLevel) / 100;
            ctx.fillStyle = 'white';
            ctx.fillRect(batteryX + 1, statusBarHeight - 14, fillWidth, 8);
            
            // Chat Header (if enabled)
            let chatY = statusBarHeight;
            if (showHeader) {
                ctx.fillStyle = '#075E54'; // WhatsApp header green
                ctx.fillRect(0, chatY, canvas.width, 60);
                // Avatar circle
                ctx.save();
                ctx.beginPath();
                ctx.arc(30, chatY + 30, 20, 0, 2 * Math.PI);
                ctx.clip();
                if (avatarImage) {
                    ctx.drawImage(avatarImage, 10, chatY + 10, 40, 40); // Draw uploaded image
                } else {
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fill();
                }
                ctx.restore();
                // Contact name
                ctx.fillStyle = 'white';
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(contactName, 60, chatY + 35);
                chatY += 60;
            }
            
            // Chat Area
            chatY += 10;
            const bubbleMargin = 20;
            const bubblePadding = 10;
            
            messages.forEach((msg, idx) => {
                const sender = msg.sender;
                const text = msg.text;
                const timeStr = msg.time;
                
                // Bubble color
                const bubbleColor = sender === 'You' ? '#DCF8C6' : '#FFFFFF';
                const textColor = '#000000';
                
                // Measure text (handle multi-line for long text)
                ctx.font = '16px Arial';
                const lines = text.split('\n'); // Split by newlines if any
                let maxLineWidth = 0;
                lines.forEach(line => {
                    const lineWidth = ctx.measureText(line).width;
                    if (lineWidth > maxLineWidth) maxLineWidth = lineWidth;
                });
                const textWidth = Math.min(maxLineWidth, canvas.width - bubbleMargin * 2 - bubblePadding * 2);
                const textHeight = lines.length * 18; // Approximate line height
                
                // Bubble size
                const bubbleWidth = textWidth + bubblePadding * 2;
                const bubbleHeight = textHeight + bubblePadding * 2;
                
                // Bubble position
                const bubbleX = sender === 'You' ? canvas.width - bubbleMargin - bubbleWidth : bubbleMargin;
                
                // Draw bubble
                ctx.fillStyle = bubbleColor;
                roundRect(ctx, bubbleX, chatY, bubbleWidth, bubbleHeight, 18); // More rounded like WhatsApp
                ctx.strokeStyle = '#E1F5FE';
                ctx.lineWidth = 1;
                ctx.stroke();
                
                // Draw text (multi-line support)
                ctx.fillStyle = textColor;
                ctx.textAlign = 'left';
                lines.forEach((line, lineIdx) => {
                    ctx.fillText(line, bubbleX + bubblePadding, chatY + bubblePadding + (lineIdx + 1) * 18);
                });
                
                // Draw checkmarks (for sent/read)
                if (sender === 'You') {
                    ctx.fillStyle = '#34B7F1'; // Blue for read
                    ctx.font = '12px Arial';
                    ctx.fillText('âœ“âœ“', bubbleX + bubbleWidth - 25, chatY + bubbleHeight + 15);
                }
                
                // Draw time
                ctx.fillStyle = '#999999';
                ctx.font = '12px Arial';
                const timeX = sender === 'You' ? bubbleX + bubbleWidth - 50 : bubbleX;
                ctx.fillText(timeStr, timeX, chatY + bubbleHeight + 15);
                
                // Apply blur if not long-pressed
                if (longPressIndex !== -1 && idx !== longPressIndex) {
                    blurArea(ctx, bubbleX, chatY, bubbleWidth, bubbleHeight + 20, 5);
                }
                
                chatY += bubbleHeight + 30;
            });
            
            // Footer (input simulation with send functionality)
            const footerY = canvas.height - 80;
            ctx.fillStyle = '#F0F0F0';
            ctx.fillRect(0, footerY, canvas.width, 80);
            ctx.fillStyle = '#FFFFFF';
            roundRect(ctx, 10, footerY + 10, canvas.width - 60, 40, 20);
            ctx.fillStyle = '#25D366';
            roundRect(ctx, canvas.width - 45, footerY + 10, 35, 40, 20);
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ðŸ“Ž', canvas.width - 27, footerY + 35); // Send icon
            
            // Show download button
            document.getElementById('downloadBtn').style.display = 'inline';
        }
        
        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
            ctx.fill();
        }
        
        function blurArea(ctx, x, y, width, height, radius) {
            const imageData = ctx.getImageData(x, y, width, height);
            const data = imageData.data;
            const blurred = new Uint8ClampedArray(data);
            
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i], g = data[i+1], b = data[i+2];
                blurred[i] = (r + (data[i-4] || r) + (data[i+4] || r)) / 3;
                blurred[i+1] = (g + (data[i-3] || g) + (data[i+5] || g)) / 3;
                blurred[i+2] = (b + (data[i-2] || b) + (data[i+6] || b)) / 3;
            }
            
            const blurredImageData = new ImageData(blurred, width, height);
            ctx.putImageData(blurredImageData, x, y);
        }
        
        function downloadImage() {
            const canvas = document.getElementById('canvas');
            const link = document.createElement('a');
            link.download = 'whatsapp_screenshot.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
    
    <!-- Footer Input Section (outside canvas, for user interaction) -->
    <div id="footerInput">
        <textarea id="footerTextarea" placeholder="Type a message..."></textarea>
        <button onclick="sendMessage()">Send</button>
    </div>
</body>
</html>